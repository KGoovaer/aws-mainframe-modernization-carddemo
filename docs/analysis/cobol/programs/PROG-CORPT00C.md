# Program Analysis: CORPT00C

## Overview
**Source File**: `app/cbl/CORPT00C.cbl`  
**Type**: Online (CICS)  
**Module**: Reporting

## Business Purpose
Allows users to submit transaction reports by injecting batch jobs into the internal reader queue (extra partition TDQ). Supports three report types: monthly (current month), yearly (current year), or custom date range. Dynamically builds JCL with date parameters and submits for batch execution.

## Key Logic

### Report Type Selection
1. **Monthly Report**: 
   - Start date: First day of current month
   - End date: Last day of current month (calculated)
   - Uses FUNCTION DATE-OF-INTEGER and INTEGER-OF-DATE for date arithmetic
2. **Yearly Report**:
   - Start date: January 1 of current year
   - End date: December 31 of current year
3. **Custom Report**:
   - User enters start date (MM/DD/YYYY)
   - User enters end date (MM/DD/YYYY)
   - Validates dates using CSUTLDTC utility
   - Numeric and range validation for each component

### Job Submission Process
1. User selects report type and provides date range (if custom)
2. User confirms submission (Y/N)
3. Program builds JCL from template (JOB-DATA structure)
4. Injects date parameters into JCL (PARM-START-DATE, PARM-END-DATE)
5. Writes JCL lines to JOBS transient data queue (TDQ)
6. CICS processes TDQ and submits job to internal reader

### Date Validation (Custom Reports)
- Month: Must be numeric, range 01-12
- Day: Must be numeric, range 01-31
- Year: Must be numeric, 4 digits
- Calls CSUTLDTC for calendar validation (leap year, day-in-month)
- Validates both start and end dates

## Data Dependencies

**Key Copybooks**:
- `COCOM01Y` - Common communication area
- `CORPT00` - Screen map (CORPT0A input/output)
- `COTTL01Y` - Title definitions
- `CSDAT01Y` - Date/time structures
- `CSMSG01Y` - Message definitions
- `CVTRA05Y` - Transaction file layout (reference)

**Files Accessed**: None (writes to TDQ only)

**CICS Resources**:
- TDQ 'JOBS' - Extra partition transient data queue for internal reader
- Transaction: CR00
- Screen: CORPT0A

## Program Relationships
**Calls**: `CSUTLDTC` (date validation utility)  
**Called By**: Main menu (COMEN01C)  
**Returns To**: Main menu (F3) or self (Enter)

## Notable Patterns

### Dynamic JCL Generation
- JCL stored as literal strings in JOB-DATA array (1000 lines)
- Date parameters embedded in multiple locations (SYMNAMES, DATEPARM)
- Uses REDEFINES to access as both structure and array
- Loops through array writing each line to TDQ until /*EOF marker

### Date Arithmetic
- FUNCTION CURRENT-DATE for base date
- FUNCTION INTEGER-OF-DATE / DATE-OF-INTEGER for month-end calculation
- Handles month rollover (December â†’ January, year increment)
- Computes last day of month by going to first of next month minus 1 day

### User Interaction Flow
1. First display: Select report type
2. If custom selected: Enter date range
3. Enter confirmation (Y/N)
4. If confirmed: Submit job, display success message
5. If declined: Clear screen and restart

### Input Validation
- FUNCTION NUMVAL-C to convert and validate numeric input
- Field-by-field validation with specific error messages
- Cursor positioned to error field on validation failure
- Date format validation before submission

### TDQ Writing
- Opens TDQ 'JOBS' (extra partition for internal reader)
- Writes fixed-length 80-byte records (JCL card image)
- Checks RESP code for each write
- Continues until end of JCL array or error

## Business Rules
1. Only one report type can be selected per submission
2. Custom reports require all six date components (MM/DD/YYYY for both dates)
3. Date validation must pass before job submission
4. User must explicitly confirm submission (Y/N)
5. Monthly report uses current calendar month boundaries
6. Yearly report uses current calendar year (Jan 1 - Dec 31)
7. Job name: TRNRPT00
8. Report generated by TRANREPT procedure (referenced in JCL)
9. Date parameters passed via SYMNAMES and DATEPARM
10. Success message includes report type submitted
